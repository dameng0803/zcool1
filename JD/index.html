<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="bootstrap.css"/>
    <title>Document</title>
    <style>
        .form-group input+span{
            display: none;
            color: #ddd;
            line-height: 20px;
            font-size:12px;
        }
        .form-group input.error{
            border-color: red;
        }
        .form-group input.error:focus{
            box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(255,0,0,.6);
        }
        .form-group input.success{
            border-color: green;
        }
        .form-group input.success:focus{
            box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(0,255,0,.6);
        }
        #submit{
            background: red;
			margin-top: 0px;
			text-indent: 0px;
			color: #fff;
        }

    </style>
</head>
<body>
    <div class="container">

        <div class="row" style="margin-top:60px;">
            <div class="col-md-6 col-md-offset-3 col-sm-10">
                <form>
                    <div class="form-group">
                        <label for="userId">用户名</label>
                        <input type="text" class="form-control" id="userId" placeholder="您的账户名和登录名">
                        <span>支持中文、英文、数字、"-"、"_"的组合，4-20个字符</span>
                    </div>
                    <div class="form-group">
                        <label for="psw">设置密码</label>
                        <input type="password" class="form-control" id="psw" placeholder="建议使用两种或两种以上字符组合">
                        <span>建议使用数字字母组合或两种以上组合的密码,6-20个字符</span>
                    </div>
                    <div class="form-group">
                            <label for="confirmpw">确认密码</label>
                            <input type="password" class="form-control" id="confirmpw" placeholder="请再次输入密码">
                            <span>请再次输入密码</span>
                    </div>
                    <div class="form-group">
                            <label for="email">邮箱</label>
                            <input type="text" class="form-control" id="email" placeholder="请输入邮箱">
                            <span>请输入有效邮箱</span>
                    </div>                        
                    <button type="submit" class="btn btn-default" id="submit">Submit</button>
              </form>
            </div>
        </div>
    </div>

    <script>
        //必填选项对象
        var fromObj = {
            userId :{
                el:$("userId"),
                reg:/^[\u4e00-\u9fa5a-z0-9\-_]{4,20}$/i,
                hasVaild:false
            },
            password:{
                el:$("psw"),
                reg:/^[a-z0-9\u0021-\u002f]{6,20}$/i,
                hasVaild:false
            },
            email:{
                el:$("email"),
                reg:/^\w{6,20}@[a-z0-9]{2,6}\.[a-z]{2,6}$/,
                hasVaild:false
            }
        }

        //用户名验证
        var userEl = fromObj.userId.el;
        var userReg =fromObj.userId.reg;

        userEl.onblur = function(){
            var string = this.value;
            this.nextElementSibling.style.display = "none";
            addOnlyState(this,userReg.test(string));


        }
        userEl.onclick = function(){
            //console.log(this.nextElementSibling);
            this.nextElementSibling.style.display = "block";

        }

        //密码的验证
        var pwEl = fromObj.password.el;
        var pwReg = fromObj.password.reg;


        pwEl.onblur = function(){
            var string = this.value;
            addOnlyState(this,pwReg.test(string));
        }
        pwEl.onclick = function(){
            //console.log(this.nextElementSibling);
            this.nextElementSibling.style.display = "block";

        }

        //确认密码验证
        var opw = document.getElementById("psw");
        var cPw = document.getElementById("confirmpw");
        cPw.onblur = function(){
            var p1 = this.value;
            var p2 = opw.value;
            cPw.className = cPw.className.replace(/\ssuccess\|\serror/,"");
            if(p1!=p2){
                cPw.className += " error";
                cPw.nextElementSibling.style.display = "block";
            }else{
                cPw.className +=" success";
                cPw.nextElementSibling.style.display = "none";
            }
        }

        cPw.onclick = function(){
            //console.log(this.nextElementSibling);
            this.nextElementSibling.style.display = "block";

        }
        //邮箱验证
        var emEl = fromObj.email.el;
        var emReg = fromObj.email.reg;

        emEl.onblur = function(){
            var string = this.value;
            addOnlyState(this,emReg.test(string));
        }
        emEl.onclick = function(){
            //console.log(this.nextElementSibling);
            this.nextElementSibling.style.display = "block";

        }



        var oSub = $("submit");

        oSub.onclick = function(e){
            var evt = e || window.event;
            for(var attr in fromObj){
                if(!fromObj[attr].reg.test(fromObj[attr].el.value)){
                    //不能提交
                    evt.preventDefault();
                    break;
                }
            }
        }

        function addOnlyState(el,bool){
            //确保元素上的 成功或失败状态唯一;
            el.className = el.className.replace(/\ssuccess\|\serror/,"");
            if(bool){
                el.nextElementSibling.style.display = "none";
                el.className +=" success";
            }else{
                el.nextElementSibling.style.display = "block";
                el.className += " error";
            }
        }

        function $(selector){
            return document.getElementById(selector);
        }
    </script>
</body>
</html>